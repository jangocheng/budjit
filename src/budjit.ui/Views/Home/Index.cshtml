@{
    ViewData["Title"] = "Home Page";
}
@model IEnumerable<budjit.core.models.Transaction>

<h1>Home Page</h1>

<h2>Your transactions - @Model.Count()</h2>

<table>
    <tr>
        <th>Date</th>
        <th>Merchant</th>
        <th>Description</th>
        <th>Alteration</th>
        <th>Balance</th>
        <th>Tag</th>
    </tr>
    @foreach (budjit.core.models.Transaction trans in Model)
    {
        <tr>
            <td>
                @trans.Date
            </td>
            <td>
                @trans.Merchant
            </td>
            <td>
                @trans.Description
            </td>
            <td>
                @trans.Alteration
            </td>
            <td>
                @trans.Balance
            </td>
            <td>
                @Html.DropDownListFor(model => trans.Tag.ID, new[] {
                    new SelectListItem { Value = "", Text = "" },
                    new SelectListItem { Value = "1", Text = "Tag 1" },
                    new SelectListItem { Value = "2", Text = "Tag 2" }
                }, new {
                    onchange = $"ChangeTag({trans.ID}, this.value);"
                })
            </td>
        </tr>
    }
</table>

<script>
    function ChangeTag(transactionId, tagId) {
        var url = '/api/transaction/'+ transactionId;
        var data = tagId;

        $.ajax({ url: url, data: JSON.stringify(data), type: 'POST', contentType: 'application/json' });
    }
</script>